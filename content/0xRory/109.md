### 19. æ¥æ”¶ETH receiveå’Œfallback

`Solidity`æ”¯æ´å…©ç¨®ç‰¹æ®Šçš„å›èª¿å‡½æ•¸ï¼Œ`receive()`å’Œ`fallback()`ï¼Œä»–å€‘ä¸»è¦åœ¨å…©ç¨®æƒ…æ³ä¸‹è¢«ä½¿ç”¨ï¼š

- æ¥æ”¶ETH

  è™•ç†åˆç´„ä¸­ä¸å­˜åœ¨çš„å‡½æ•¸å‘¼å«ï¼ˆä»£ç†åˆç´„proxy contractï¼‰

  æ³¨æ„âš ï¸ï¼šåœ¨Solidity 0.6.xç‰ˆæœ¬ä¹‹å‰ï¼Œèªæ³•ä¸Šåªæœ‰fallback()å‡½æ•¸ï¼Œç”¨ä¾†æ¥æ”¶ç”¨æˆ¶ç™¼é€çš„ETHæ™‚èª¿ç”¨ä»¥åŠåœ¨è¢«èª¿ç”¨å‡½æ•¸ç°½åæ²’æœ‰åŒ¹é…åˆ°æ™‚ï¼Œä¾†èª¿ç”¨ã€‚ 
  
  0.6ç‰ˆæœ¬ä¹‹å¾Œï¼ŒSolidityæ‰å°‡fallback()å‡½æ•¸æ‹†åˆ†æˆreceive()å’Œfallback()å…©å€‹å‡½æ•¸ã€‚

  `receive()`å‡½æ•¸æ˜¯åœ¨åˆç´„æ”¶åˆ°ETHè½‰å¸³æ™‚è¢«å‘¼å«çš„å‡½æ•¸ã€‚
  `ä¸€å€‹åˆç´„æœ€å¤šæœ‰ä¸€å€‹receive()å‡½æ•¸`ï¼Œå®£å‘Šæ–¹å¼èˆ‡ä¸€èˆ¬å‡½æ•¸ä¸ä¸€æ¨£ï¼Œä¸éœ€è¦functioné—œéµå­—ï¼š
  
  `receive() external payable { ... }ã€‚`
  
  `receive()`å‡½æ•¸ä¸èƒ½æœ‰ä»»ä½•çš„åƒæ•¸ï¼Œä¸èƒ½å‚³å›ä»»ä½•å€¼ï¼Œå¿…é ˆåŒ…å«externalå’Œpayableã€‚

  ğŸ§‘â€ğŸ’» ç•¶åˆç´„æ¥æ”¶ETHçš„æ™‚å€™ï¼Œ`receive()`æœƒè¢«è§¸ç™¼ã€‚
  
  `receive()`æœ€å¥½ä¸è¦åŸ·è¡Œå¤ªå¤šçš„é‚è¼¯å› ç‚ºå¦‚æœåˆ¥äººç”¨sendå’Œtransferæ–¹æ³•ç™¼é€ETHçš„è©±ï¼Œgasæœƒé™åˆ¶åœ¨2300ï¼Œ
  
  `receive()`å¤ªè¤‡é›œå¯èƒ½æœƒè§¸ç™¼Out of Gaså ±éŒ¯ï¼›
  
  å¦‚æœç”¨callå°±å¯ä»¥è‡ªè¨‚gasåŸ·è¡Œæ›´è¤‡é›œçš„é‚è¼¯ï¼ˆé€™ä¸‰ç¨®ç™¼é€ETHçš„æ–¹æ³•æˆ‘å€‘ä¹‹å¾Œæœƒè¬›åˆ°ï¼‰ã€‚

ç¯„ä¾‹ï¼š
  
  ```solidity
    // å®šä¹‰äº‹ä»¶
    event Received(address Sender, uint Value);
    // æ¥æ”¶ETHæ—¶é‡Šæ”¾Receivedäº‹ä»¶
    receive() external payable {
        emit Received(msg.sender, msg.value);
    }
  ```

- å›é€€å‡½æ•¸
  `fallback()`
  
    å‡½æ•¸æœƒåœ¨å‘¼å«åˆç´„ä¸å­˜åœ¨çš„å‡½æ•¸æ™‚è¢«è§¸ç™¼ã€‚

å¯ç”¨æ–¼æ¥æ”¶ETHï¼Œä¹Ÿå¯ç”¨æ–¼ä»£ç†åˆç´„`proxy contract`ã€‚`fallback()`è²æ˜æ™‚ä¸éœ€è¦functioné—œéµå­—ï¼Œå¿…é ˆç”±externalä¿®é£¾ï¼Œä¸€èˆ¬ä¹Ÿæœƒç”¨payableä¿®é£¾ï¼Œç”¨æ–¼æ¥æ”¶ETH: `fallback() external payable { ... }`

æˆ‘å€‘å®šç¾©ä¸€å€‹fallback()å‡½æ•¸ï¼Œè¢«è§¸ç™¼æ™‚å€™æœƒé‡‹æ”¾fallbackCalledäº‹ä»¶ï¼Œä¸¦è¼¸å‡ºmsg.senderï¼Œmsg.valueå’Œmsg.data:

```solidity
    event fallbackCalled(address Sender, uint Value, bytes Data);

    // fallback
    fallback() external payable{
        emit fallbackCalled(msg.sender, msg.value, msg.data);
    }
```

è§¸ç™¼ `receive()` å’Œ `fallback()` å‡½æ•¸çš„æ¢ä»¶ï¼š

```
           æ¥æ”¶ETH
              |
         msg.dataæ˜¯ç©ºï¼Ÿ
            /  \
          æ˜¯    å¦
          /      \
receive()å­˜åœ¨?   fallback()
        / \
       æ˜¯  å¦
      /     \
receive()   fallback()
```

ğŸ§‘â€ğŸ’»  å¦‚æœä½ æœ‰å®šç¾© `receive`, `fallback` è«‹è¨˜å¾—ä¸ç®¡æœ‰æ²’æœ‰å‘¼å«æˆåŠŸåŸ·è¡Œäº†éŒ¢éƒ½é€äº†å–”ã€‚æ²’å®šç¾©å°±æ˜¯å ±éŒ¯èª¤ã€‚

### 20. ç™¼é€ ETH

`Solidity`æœ‰ä¸‰ç¨®æ–¹æ³•å‘å…¶ä»–åˆç´„ç™¼é€ETHï¼Œä»–å€‘æ˜¯
- `transfer()`
- `send()`
- `call()`ï¼Œ(è¢«é¼“å‹µçš„ç”¨æ³•)