### 15. ç•°å¸¸

`Solidity` ä¸‰ç¨®æ‹‹å‡ºç•°å¸¸çš„æ–¹æ³•ï¼š`error`ï¼Œ`require`å’Œ`assert`ï¼Œä¸¦æ¯”è¼ƒä¸‰ç¨®æ–¹æ³•çš„gasæ¶ˆè€—ã€‚

`error`æ˜¯`solidity 0.8.4`ç‰ˆæœ¬æ–°åŠ çš„å…§å®¹ï¼Œæ–¹ä¾¿ä¸”æœ‰æ•ˆç‡ï¼ˆçœgasï¼‰åœ°å‘ä½¿ç”¨è€…è§£é‡‹æ“ä½œå¤±æ•—çš„åŸå› ï¼ŒåŒæ™‚é‚„å¯ä»¥åœ¨æ‹‹å‡ºç•°å¸¸çš„åŒæ™‚æ”œå¸¶åƒæ•¸ï¼Œå¹«åŠ©é–‹ç™¼è€…æ›´å¥½åœ°èª¿è©¦ã€‚äººå€‘å¯ä»¥åœ¨`contract`ä¹‹å¤–å®šç¾©ç•°å¸¸ã€‚ä¸‹é¢ï¼Œæˆ‘å€‘å®šç¾©ä¸€å€‹TransferNotOwnerç•°å¸¸ï¼Œç•¶ç”¨æˆ¶ä¸æ˜¯ä»£å¹£ownerçš„æ™‚å€™å˜—è©¦è½‰è³¬ï¼Œæœƒæ‹‹å‡ºéŒ¯èª¤ï¼š

```
error TransferNotOwner(); // è‡ªå®šä¹‰error
```

æˆ‘å€‘ä¹Ÿå¯ä»¥å®šç¾©ä¸€å€‹æ”œå¸¶åƒæ•¸çš„ç•°å¸¸ï¼Œä¾†æç¤ºå˜—è©¦è½‰å¸³çš„å¸³æˆ¶åœ°å€
```
error TransferNotOwner(address sender); // è‡ªå®šä¹‰çš„å¸¦å‚æ•°çš„error
```

ğŸ§‘â€ğŸ’» åœ¨åŸ·è¡Œç•¶ä¸­ï¼Œ`error` å¿…é ˆæ­é… `revert`ï¼ˆå›é€€ï¼‰æŒ‡ä»¤ä½¿ç”¨ã€‚

```
function transferOwner1(uint256 tokenId, address newOwner) public {
    if(_owners[tokenId] != msg.sender){
        revert TransferNotOwner();
        // revert TransferNotOwner(msg.sender);
    }
    _owners[tokenId] = newOwner;
}
```

æˆ‘å€‘å®šç¾©äº†ä¸€å€‹`transferOwner1()`å‡½æ•¸ï¼Œå®ƒæœƒæª¢æŸ¥ä»£å¹£çš„`owner`æ˜¯ä¸æ˜¯ç™¼èµ·äººï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±æœƒæ‹‹å‡º`TransferNotOwner`ç•°å¸¸ï¼›å¦‚æœæ˜¯çš„è©±ï¼Œå°±æœƒè½‰å¸³ã€‚

ğŸ§‘â€ğŸ’» `require`å‘½ä»¤æ˜¯solidity 0.8ç‰ˆæœ¬ä¹‹å‰æ‹‹å‡ºç•°å¸¸çš„å¸¸ç”¨æ–¹æ³•ï¼Œç›®å‰è¨±å¤šä¸»æµåˆç´„ä»ç„¶é‚„åœ¨ä½¿ç”¨å®ƒã€‚
å®ƒå¾ˆå¥½ç”¨ï¼Œå”¯ä¸€çš„ç¼ºé»å°±æ˜¯gaséš¨è‘—æè¿°ç•°å¸¸çš„å­—ä¸²é•·åº¦å¢åŠ ï¼Œæ¯”erroræŒ‡ä»¤é«˜ã€‚

- ä½¿ç”¨æ–¹æ³•ï¼šrequire(æ£€æŸ¥æ¡ä»¶ï¼Œ"å¼‚å¸¸çš„æè¿°")ï¼Œç•¶æª¢æŸ¥æ¢ä»¶ä¸æˆç«‹çš„æ™‚å€™ï¼Œå°±æœƒæ‹‹å‡ºä¾‹å¤–ã€‚

æˆ‘å€‘ç”¨requireå‘½ä»¤é‡å¯«ä¸Šé¢çš„transferOwner1å‡½æ•¸ï¼š
```
function transferOwner2(uint256 tokenId, address newOwner) public {
    require(_owners[tokenId] == msg.sender, "Transfer Not Owner");
    _owners[tokenId] = newOwner;
}
```
`assert`å‘½ä»¤ä¸€èˆ¬ç”¨æ–¼ç¨‹å¼è¨­è¨ˆå¸«å¯«ç¨‹åºdebugï¼Œå› ç‚ºå®ƒä¸èƒ½è§£é‡‹æ‹‹å‡ºç•°å¸¸çš„åŸå› ï¼ˆæ¯”requireå°‘å€‹å­—ä¸²ï¼‰ã€‚å®ƒçš„ç”¨æ³•å¾ˆç°¡å–®ï¼Œ`assert`(æ£€æŸ¥æ¡ä»¶ï¼‰ï¼Œç•¶æª¢æŸ¥æ¢ä»¶ä¸æˆç«‹çš„æ™‚å€™ï¼Œå°±æœƒæ‹‹å‡ºç•°å¸¸ã€‚

æˆ‘å€‘ç”¨`assert`å‘½ä»¤é‡å¯«ä¸Šé¢çš„`transferOwner1`å‡½æ•¸ï¼š

```
function transferOwner3(uint256 tokenId, address newOwner) public {
    assert(_owners[tokenId] == msg.sender);
    _owners[tokenId] = newOwner;
}
```

`error ` çš„æŒ‡ä»¤æ˜¯ä»¥ function åç¨±ä¾†ä»£æ›¿éŒ¯èª¤è¨Šæ¯çš„å‘ˆç¾ï¼Œèˆ‡ require ç›¸æ¯”ï¼Œ`error` çš„ gas æ¶ˆè€—è¼ƒä½ï¼Œå› ç‚ºå®ƒä¸æœƒå°‡éŒ¯èª¤è¨Šæ¯å¯«å…¥åˆ°å€å¡Šéˆä¸­ã€‚

#### ä¸‰ç¨®æ–¹æ³•çš„gas
è®“æˆ‘å€‘æ¯”è¼ƒä¸€ä¸‹ä¸‰ç¨®æ‹‹å‡ºç•°å¸¸çš„`gas`æ¶ˆè€—ï¼Œé€éremixæ§åˆ¶å°çš„DebugæŒ‰éˆ•ï¼Œèƒ½æŸ¥åˆ°æ¯æ¬¡å‡½æ•¸å‘¼å«çš„gasæ¶ˆè€—åˆ†åˆ¥å¦‚ä¸‹ï¼š ï¼ˆä½¿ç”¨0.8.17ç‰ˆæœ¬ç·¨è­¯ï¼‰

- `error`æ–¹æ³•`gas`æ¶ˆè€—ï¼š24457 (åŠ å…¥åƒæ•¸å¾Œgasæ¶ˆè€—ï¼š24660)
- `require`æ–¹æ³•`gas`æ¶ˆè€—ï¼š24755
- `assert`æ–¹æ³•`gas`æ¶ˆè€—ï¼š24473
æˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼Œerroræ–¹æ³•gasæœ€å°‘ï¼Œå…¶æ¬¡æ˜¯assertï¼Œrequireæ–¹æ³•æ¶ˆè€—gasæœ€å¤šï¼

å› æ­¤ï¼Œerroræ—¢å¯ä»¥å‘ŠçŸ¥ç”¨æˆ¶æ‹‹å‡ºç•°å¸¸çš„åŸå› ï¼Œåˆèƒ½çœgasï¼Œå¤§å®¶è¦å¤šç”¨ï¼
 ï¼ˆæ³¨æ„ï¼Œç”±æ–¼éƒ¨ç½²æ¸¬è©¦æ™‚é–“çš„ä¸åŒï¼Œæ¯å€‹å‡½æ•¸çš„gasæ¶ˆè€—æœƒæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯æ¯”è¼ƒçµæœæœƒæ˜¯ä¸€è‡´çš„ã€‚ï¼‰

### 16. å‡½æ•¸é‡è¼‰

`Solidity` ä¸­å…è¨±å‡½æ•¸é€²è¡Œé‡è¼‰ï¼ˆoverloadingï¼‰ï¼Œå³åå­—ç›¸åŒä½†è¼¸å…¥åƒæ•¸é¡å‹ä¸åŒçš„å‡½æ•¸å¯ä»¥åŒæ™‚å­˜åœ¨ï¼Œä»–å€‘è¢«è¦–ç‚ºä¸åŒçš„å‡½æ•¸ã€‚æ³¨æ„ï¼ŒSolidityä¸å…è¨±ä¿®é£¾å™¨ï¼ˆmodifierï¼‰é‡è¼‰ã€‚

ä¾‹å­ï¼š
```
function saySomething() public pure returns(string memory){
    return("Nothing");
}

function saySomething(string memory something) public pure returns(string memory){
    return(something);
}
```

å¯ä»¥çœ‹åˆ° function name æ˜¯ä¸€æ¨£çš„ä½†æ˜¯æ²’æœ‰éŒ¯ï¼ˆåƒæ•¸ä¸åŒï¼‰å¯¦ç¾å¤šè¼‰

ä½†æœ‰ä¸€é»è¦æ³¨æ„çš„

ğŸ§‘â€ğŸ’» åœ¨å‘¼å«é‡è¼‰å‡½æ•¸æ™‚ï¼ŒæœƒæŠŠè¼¸å…¥çš„å¯¦éš›åƒæ•¸å’Œå‡½æ•¸åƒæ•¸çš„è®Šæ•¸é¡å‹åšæˆåŒ¹é…ã€‚ å¦‚æœå‡ºç¾å¤šå€‹ç¬¦åˆçš„é‡è¼‰å‡½æ•¸ï¼Œå‰‡æœƒå ±éŒ¯ã€‚ä¸‹é¢é€™å€‹ä¾‹å­æœ‰å…©å€‹å«f()çš„å‡½æ•¸ï¼Œä¸€å€‹åƒæ•¸ç‚º`uint8`ï¼Œå¦ä¸€å€‹ç‚º`uint256`ï¼š
```solidity
function f(uint8 _in) public pure returns (uint8 out) {
    out = _in;
}

function f(uint256 _in) public pure returns (uint256 out) {
    out = _in;
}
```
æˆ‘å€‘èª¿ç”¨f(50)ï¼Œå› ç‚º50æ—¢å¯ä»¥è¢«è½‰æ›ç‚ºuint8ï¼Œä¹Ÿå¯ä»¥è¢«è½‰æ›ç‚ºuint256ï¼Œå› æ­¤æœƒå ±éŒ¯ã€‚

æ³¨æ„ä¸‹é¢é€™å€‹é›–ç„¶æœƒéŒ¯èª¤ï¼Œä½†æ˜¯é¸æ“‡æ£„é‚„æ˜¯ä¸ä¸€æ¨£å–”ï¼ˆåƒæ•¸ä¸åŒï¼‰
```
function f(uint8 _in) public pure returns (uint8 out) { 
 out = _in; 
 } 

function f(uint256 _in) public pure returns (uint256 out) { 
 out = _in; 
 }
```

### 17. åº«åˆç´„ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Š

åº«åˆç´„æ˜¯ä¸€ç¨®ç‰¹æ®Šçš„åˆç´„ï¼Œç‚ºäº†æå‡`Solidity`ç¨‹å¼ç¢¼çš„è¤‡ç”¨æ€§å’Œæ¸›å°‘`gas`è€Œå­˜åœ¨ã€‚åº«åˆç´„æ˜¯ä¸€ç³»åˆ—çš„å‡½æ•¸åˆé›†ï¼Œç”±å¤§ç¥æˆ–å°ˆæ¡ˆæ–¹å‰µä½œï¼Œå’±å€‘ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œæœƒç”¨å°±è¡Œäº†ã€‚
ï¼ˆå°±æ˜¯æŠŠä¸€äº›å¸¸ç”¨çš„å‡½æ•¸å¯«æˆåº«åˆç´„ï¼Œä¾›å¤§å®¶èª¿ç”¨ï¼‰

ä»–å’Œæ™®é€šåˆç´„ä¸»è¦æœ‰ä»¥ä¸‹å¹¾é»ä¸åŒï¼š

- ä¸èƒ½å­˜åœ¨ç‹€æ…‹è®Šæ•¸
- ä¸èƒ½ç¹¼æ‰¿æˆ–è¢«ç¹¼æ‰¿
- ä¸èƒ½æ¥æ”¶ä»¥å¤ªå¹£
- ä¸å¯ä»¥è¢«éŠ·æ¯€

####  å¦‚ä½•èª¿ç”¨åº«åˆç´„ï¼Ÿ

- åˆ©ç”¨using foræŒ‡ä»¤

æŒ‡ä»¤using A for B;å¯ç”¨æ–¼é™„åŠ åº«åˆç´„ï¼ˆå¾åº«Aï¼‰åˆ°ä»»ä½•é¡å‹ï¼ˆBï¼‰ã€‚æ–°å¢æŒ‡ä»¤å¾Œï¼Œåº«Aä¸­çš„å‡½æ•¸æœƒè‡ªå‹•åŠ å…¥ç‚ºBé¡å‹è®Šæ•¸çš„æˆå“¡ï¼Œå¯ä»¥ç›´æ¥å‘¼å«ã€‚æ³¨æ„ï¼šåœ¨å‘¼å«çš„æ™‚å€™ï¼Œé€™å€‹è®Šæ•¸æœƒè¢«ç•¶ä½œç¬¬ä¸€å€‹åƒæ•¸å‚³éçµ¦å‡½æ•¸ï¼š
```
// åˆ©ç”¨using foræŒ‡ä»¤
using Strings for uint256;
function getString1(uint256 _number) public pure returns(string memory){
    // åº“åˆçº¦ä¸­çš„å‡½æ•°ä¼šè‡ªåŠ¨æ·»åŠ ä¸ºuint256å‹å˜é‡çš„æˆå‘˜
    return _number.toHexString();
}
```
- é€éåº«åˆç´„åç¨±å‘¼å«å‡½æ•¸
```
// ç›´æ¥é€šè¿‡åº“åˆçº¦åè°ƒç”¨
function getString2(uint256 _number) public pure returns(string memory){
    return Strings.toHexString(_number);
}
```
é€™å¹¾å€‹ libraryå¾ˆå¥½ç”¨
- Stringsï¼šå°‡uint256è½‰æ›ç‚ºString
- Addressï¼šåˆ¤æ–·æŸå€‹åœ°å€æ˜¯å¦ç‚ºåˆç´„åœ°å€
- Create2ï¼šæ›´å®‰å…¨çš„ä½¿ç”¨Create2 EVM opcode
- Arraysï¼šè·Ÿæ•¸çµ„ç›¸é—œçš„åº«åˆç´„

### 18. Import

`import` å°å…¥æ–‡ä»¶åŸºæœ¬ä¸Šå’Œ javascript çš„å¼•å…¥ä¸€æ¨£ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ githubçš„éƒ¨åˆ†